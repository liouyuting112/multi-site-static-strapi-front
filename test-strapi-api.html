<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>測試 Strapi API</title>
</head>
<body>
    <h1>Strapi API 測試</h1>
    <button onclick="testAPI()">測試 API</button>
    <div id="result"></div>

    <script>
        const STRAPI_URL = 'http://localhost:1337';
        
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>測試中...</p>';
            
            try {
                // 測試 1: 檢查 Strapi 是否運行
                const healthCheck = await fetch(`${STRAPI_URL}/api/posts?pagination[limit]=1`);
                console.log('Health check status:', healthCheck.status);
                
                if (!healthCheck.ok) {
                    resultDiv.innerHTML = `<p style="color: red;">❌ Strapi 無法連接 (${healthCheck.status})</p>`;
                    return;
                }
                
                // 測試 2: 獲取 site1 的 daily 文章
                const url = `${STRAPI_URL}/api/posts?filters[site][$eq]=site1&filters[category][$eq]=daily&sort=publishedAt:desc`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    resultDiv.innerHTML = `<p style="color: red;">❌ API 請求失敗 (${response.status}): ${await response.text()}</p>`;
                    return;
                }
                
                const data = await response.json();
                console.log('API Response:', data);
                
                if (data.data && data.data.length > 0) {
                    const posts = data.data.map(item => {
                        const attrs = item.attributes || item;
                        return {
                            id: item.id,
                            title: attrs.title,
                            slug: attrs.slug,
                            publishedAt: attrs.publishedAt,
                            category: attrs.category
                        };
                    });
                    
                    resultDiv.innerHTML = `
                        <p style="color: green;">✅ API 連接成功！</p>
                        <p>找到 ${posts.length} 篇文章：</p>
                        <ul>
                            ${posts.map(p => `<li>${p.title} (${p.slug}) - Published: ${p.publishedAt ? '是' : '否'}</li>`).join('')}
                        </ul>
                    `;
                } else {
                    resultDiv.innerHTML = `<p style="color: orange;">⚠️ API 連接成功，但沒有找到文章</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ 錯誤: ${error.message}</p>`;
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>

